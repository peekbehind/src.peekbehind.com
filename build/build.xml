<?xml version="1.0" encoding="UTF-8"?>
<project name="peekbehind" basedir=".." default="export">
  <!--
    Build script to generate optimized website for PeekBehind.com

    Author: Eric BrÃ©chemier
    License: http://creativecommons.org/licenses/by/3.0/
    Version: 2013-02-15
  -->

  <!-- override defaults locally -->
  <property file="build/user.properties" />

  <!-- list of parameters used, with default values -->

  <!-- relative path to output folder for the optimized web site -->
  <property name="output.dir" value="../peekbehind.com" />

  <import file="macros.xml" />

  <target name="export" description="Export web site to target folder"
    depends="html, images, fonts, css, seo"
  />

  <macrodef name="unindent">
    <attribute name="html" />
    <sequential>
      <saxon xml="@{html}"
           xsl="build/xsl/html5noindent.xsl"
           out="${output.dir}/@{html}"
      />
    </sequential>
  </macrodef>

  <target name="html" description="Optimize HTML by removing indent">
    <unindent html="index.html" />
    <unindent html="for/wordpress/index.html" />
    <unindent html="for/websites/index.html" />
    <unindent html="for/you/index.html" />
    <unindent html="subscribe/wordpress/index.html" />
    <unindent html="subscribe/websites/index.html" />
    <unindent html="subscribe/cancel/index.html" />
    <unindent html="unsubscribe/index.html" />
  </target>

  <target name="css" description="Optimize CSS and copy images and fonts">
    <yuicompressor
      in="style/peekbehind.css"
      out="${output.dir}/style/peekbehind.css"
    />
  </target>

  <target name="images" description="Copy images to website folder">
    <copy todir="${output.dir}">
      <fileset dir="." includes="favicon.ico" />
    </copy>
    <copy todir="${output.dir}/style">
      <fileset dir="style" includes="*.png *.jpg" />
    </copy>
  </target>

  <target name="fonts" description="Copy fonts to website folder">
    <copy todir="${output.dir}/style/fonts">
      <dirset dir="style/fonts" />
    </copy>
  </target>

  <target name="seo" description="Copy files for search engine optimization">
    <copy todir="${output.dir}">
      <fileset dir="." includes="robots.txt" />
    </copy>
  </target>

</project>
